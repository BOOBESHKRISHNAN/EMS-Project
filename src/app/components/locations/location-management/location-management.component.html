<div class="location-management-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1><i class="fas fa-map-marker-alt"></i> Location Management</h1>
      <p>Manage venues and event locations</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="showCreateLocationForm()" [disabled]="loading">
        <i class="fas fa-plus"></i> Add New Location
      </button>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="error" class="alert alert-error">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    {{ successMessage }}
  </div>

  <!-- Create Location Form -->
  <div *ngIf="showCreateForm" class="form-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-plus-circle"></i> Create New Location</h3>
        <button class="btn-close" (click)="hideCreateForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="createForm" (ngSubmit)="createLocation()">
        <div class="form-grid">
          <div class="form-group">
            <label for="createName">Location Name *</label>
            <input 
              type="text" 
              id="createName"
              formControlName="name"
              [class.error]="isFieldInvalid(createForm, 'name')"
              placeholder="Enter location name">
            <div *ngIf="getFieldError(createForm, 'name')" class="field-error">
              {{ getFieldError(createForm, 'name') }}
            </div>
          </div>

          <div class="form-group">
            <label for="createVenueFee">Venue Fee *</label>
            <input 
              type="number" 
              id="createVenueFee"
              formControlName="venueFee"
              [class.error]="isFieldInvalid(createForm, 'venueFee')"
              placeholder="0.00"
              min="0"
              step="0.01">
            <div *ngIf="getFieldError(createForm, 'venueFee')" class="field-error">
              {{ getFieldError(createForm, 'venueFee') }}
            </div>
          </div>

          <div class="form-group full-width">
            <label for="createAddress">Address *</label>
            <input 
              type="text" 
              id="createAddress"
              formControlName="address"
              [class.error]="isFieldInvalid(createForm, 'address')"
              placeholder="Enter street address">
            <div *ngIf="getFieldError(createForm, 'address')" class="field-error">
              {{ getFieldError(createForm, 'address') }}
            </div>
          </div>

          <div class="form-group">
            <label for="createCity">City *</label>
            <input 
              type="text" 
              id="createCity"
              formControlName="city"
              [class.error]="isFieldInvalid(createForm, 'city')"
              placeholder="Enter city">
            <div *ngIf="getFieldError(createForm, 'city')" class="field-error">
              {{ getFieldError(createForm, 'city') }}
            </div>
          </div>

          <div class="form-group">
            <label for="createState">State *</label>
            <input 
              type="text" 
              id="createState"
              formControlName="state"
              [class.error]="isFieldInvalid(createForm, 'state')"
              placeholder="Enter state">
            <div *ngIf="getFieldError(createForm, 'state')" class="field-error">
              {{ getFieldError(createForm, 'state') }}
            </div>
          </div>

          <div class="form-group">
            <label for="createZipCode">ZIP Code</label>
            <input 
              type="text" 
              id="createZipCode"
              formControlName="zipCode"
              placeholder="Enter ZIP code">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="hideCreateForm()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading || !createForm.valid">
            <i class="fas fa-save"></i>
            {{ loading ? 'Creating...' : 'Create Location' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Location Form -->
  <div *ngIf="showEditForm" class="form-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-edit"></i> Edit Location</h3>
        <button class="btn-close" (click)="hideEditForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="editForm" (ngSubmit)="updateLocation()">
        <div class="form-grid">
          <div class="form-group">
            <label for="editName">Location Name *</label>
            <input 
              type="text" 
              id="editName"
              formControlName="name"
              [class.error]="isFieldInvalid(editForm, 'name')"
              placeholder="Enter location name">
            <div *ngIf="getFieldError(editForm, 'name')" class="field-error">
              {{ getFieldError(editForm, 'name') }}
            </div>
          </div>

          <div class="form-group">
            <label for="editVenueFee">Venue Fee *</label>
            <input 
              type="number" 
              id="editVenueFee"
              formControlName="venueFee"
              [class.error]="isFieldInvalid(editForm, 'venueFee')"
              placeholder="0.00"
              min="0"
              step="0.01">
            <div *ngIf="getFieldError(editForm, 'venueFee')" class="field-error">
              {{ getFieldError(editForm, 'venueFee') }}
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="hideEditForm()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="loading || !editForm.valid">
            <i class="fas fa-save"></i>
            {{ loading ? 'Updating...' : 'Update Location' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Search locations by name, city, state, or address..."
        class="search-input">
    </div>
    
    <div class="filter-info">
      <span class="results-count">
        {{ filteredLocations.length }} of {{ locations.length }} locations
      </span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && !showCreateForm && !showEditForm" class="loading-container">
    <div class="spinner"></div>
    <p>Loading locations...</p>
  </div>

  <!-- Locations Table -->
  <div *ngIf="!loading || showCreateForm || showEditForm" class="locations-table-container">
    <div *ngIf="filteredLocations.length === 0 && !loading" class="no-data">
      <i class="fas fa-map-marker-alt"></i>
      <h3>No locations found</h3>
      <p *ngIf="searchTerm">Try adjusting your search criteria.</p>
      <p *ngIf="!searchTerm">Start by creating your first location.</p>
    </div>

    <table *ngIf="filteredLocations.length > 0" class="locations-table">
      <thead>
        <tr>
          <th (click)="onSortChange('name')" class="sortable">
            Location Name
            <i [class]="getSortIcon('name')"></i>
          </th>
          <th>Address</th>
          <th (click)="onSortChange('city')" class="sortable">
            City/State
            <i [class]="getSortIcon('city')"></i>
          </th>
          <th (click)="onSortChange('venueFee')" class="sortable">
            Venue Fee
            <i [class]="getSortIcon('venueFee')"></i>
          </th>
          <th (click)="onSortChange('events')" class="sortable">
            Events
            <i [class]="getSortIcon('events')"></i>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let location of filteredLocations" class="location-row">
          <td class="location-name">
            <strong>{{ location.name }}</strong>
          </td>
          <td class="location-address">
            {{ location.address }}
            <span *ngIf="location.zipCode" class="zip-code">{{ location.zipCode }}</span>
          </td>
          <td class="location-city">
            {{ location.city }}, {{ location.state }}
          </td>
          <td class="venue-fee">
            {{ formatCurrency(location.venueFee) }}
          </td>
          <td class="events-count">
            <span class="event-badge" [class.has-events]="location.events.length > 0">
              {{ location.events.length }}
            </span>
            <span *ngIf="location.events.length > 0" class="events-tooltip">
              {{ location.events.length }} event(s) scheduled
            </span>
          </td>
          <td class="actions">
            <button 
              class="btn btn-sm btn-outline" 
              (click)="showEditLocationForm(location)"
              [disabled]="loading"
              title="Edit location">
              <i class="fas fa-edit"></i>
            </button>
            <button 
              class="btn btn-sm btn-danger" 
              (click)="deleteLocation(location)"
              [disabled]="loading || !canDeleteLocation(location)"
              [title]="canDeleteLocation(location) ? 'Delete location' : 'Cannot delete location with associated events'">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Location Details Modal (if needed for viewing events) -->
  <!-- This could be expanded to show location details and associated events -->
  
</div>